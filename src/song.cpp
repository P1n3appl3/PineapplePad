#include <stdint.h>
#include "../inc/tm4c123gh6pm.h"
#include "../inc/song.h"
#include "../inc/sound.h"
#include "../inc/IO.h"

uint16_t note;
uint32_t counter;
const uint32_t pitch[] = {1896,0,0,1896,0,0,1896,0,0,2388,0,0,1896,0,0,1594,0,0,2388,0,0,3188,0,0,3792,0,0,2840,0,0,2530,0,0,2681,0,0,2840,0,0,3188,0,0,1896,0,0,1594,0,0,1420,0,0,1789,0,0,1594,0,0,1896,0,0,2388,0,0,2128,0,0,2530,0,0,2388,0,0,3188,0,0,3792,0,0,2840,0,0,2530,0,0,2681,0,0,2840,0,0,3188,0,0,1896,0,0,1594,0,0,1420,0,0,1789,0,0,1594,0,0,1896,0,0,2388,0,0,2128,0,0,2530,0,0,1594,0,0,1689,0,0,1789,0,0,2008,0,0,1896,0,0,3009,0,0,2840,0,0,2388,0,0,2840,0,0,2388,0,0,2128,0,0,1594,0,0,1689,0,0,1789,0,0,2008,0,0,1896,0,0,1194,0,0,1194,0,0,1194,0,0,1594,0,0,1689,0,0,1789,0,0,2008,0,0,1896,0,0,3009,0,0,2840,0,0,2388,0,0,2840,0,0,2388,0,0,2128,0,0,2008,0,0,2128,0,0,2388,0,0,1594,0,0,1689,0,0,1789,0,0,2008,0,0,1896,0,0,3009,0,0,2840,0,0,2388,0,0,2840,0,0,2388,0,0,2128,0,0,1594,0,0,1689,0,0,1789,0,0,2008,0,0,1896,0,0,1194,0,0,1194,0,0,1194,0,0,1594,0,0,1689,0,0,1789,0,0,2008,0,0,1896,0,0,3009,0,0,2840,0,0,2388,0,0,2840,0,0,2388,0,0,2128,0,0,2008,0,0,2128,0,0,2388,0,0,2388,0,0,2388,0,0,2388,0,0,2388,0,0,2128,0,0,1896,0,0,2388,0,0,2840,0,0,3188,0,0,2388,0,0,2388,0,0,2388,0,0,2388,0,0,2128,0,0,1896,0,0,2388,0,0,2388,0,0,2388,0,0,2388,0,0,2128,0,0,1896,0,0,2388,0,0,2840,0,0,3188,0,0,1896,0,0,1896,0,0,1896,0,0,2388,0,0,1896,0,0,1594,0,0,2388,0,0,3188,0,0,3792,0,0,2840,0,0,2530,0,0,2681,0,0,2840,0,0,3188,0,0,1896,0,0,1594,0,0,1420,0,0,1789,0,0,1594,0,0,1896,0,0,2388,0,0,2128,0,0,2530,0,0,2388,0,0,3188,0,0,3792,0,0,2840,0,0,2530,0,0,2681,0,0,2840,0,0,3188,0,0,1896,0,0,1594,0,0,1420,0,0,1789,0,0,1594,0,0,1896,0,0,2388,0,0,2128,0,0,2530,0,0,1896,0,0,2388,0,0,3188,0,0,3009,0,0,2840,0,0,1789,0,0,1789,0,0,2840,0,0,2530,0,0,1420,0,0,1420,0,0,1420,0,0,1594,0,0,1789,0,0,1896,0,0,2388,0,0,2840,0,0,3188,0,0,1896,0,0,2388,0,0,3188,0,0,3009,0,0,2840,0,0,1789,0,0,1789,0,0,2840,0,0,2530,0,0,1789,0,0,1789,0,0,1789,0,0,1896,0,0,2128,0,0,2388,0,0,1896,0,0,2388,0,0,3188,0,0,3009,0,0,2840,0,0,1789,0,0,1789,0,0,2840,0,0,2530,0,0,1420,0,0,1420,0,0,1420,0,0,1594,0,0,1789,0,0,1896,0,0,2388,0,0,2840,0,0,3188,0,0,1896,0,0,2388,0,0,3188,0,0,3009,0,0,2840,0,0,1789,0,0,1789,0,0,2840,0,0,2530,0,0,1789,0,0,1789,0,0,1789,0,0,1896,0,0,2128,0,0,2388,0,0,2388,0,0,2388,0,0,2388,0,0,2388,0,0,2128,0,0,1896,0,0,2388,0,0,2840,0,0,3188,0,0,2388,0,0,2388,0,0,2388,0,0,2388,0,0,2128,0,0,1896,0,0,2388,0,0,2388,0,0,2388,0,0,2388,0,0,2128,0,0,1896,0,0,2388,0,0,2840,0,0,3188,0,0,1896,0,0,1896,0,0,1896,0,0,2388,0,0,1896,0,0,1594,0,0,1896,0,0,2388,0,0,3188,0,0,3009,0,0,2840,0,0,1789,0,0,1789,0,0,2840,0,0,2530,0,0,1420,0,0,1420,0,0,1420,0,0,1594,0,0,1789,0,0,1896,0,0,2388,0,0,2840,0,0,3188,0,0,1896,0,0,2388,0,0,3188,0,0,3009,0,0,2840,0,0,1789,0,0,1789,0,0,2840,0,0,2530,0,0,1789,0,0,1789,0,0,1789,0,0,1896,0,0,2128,0,0,2388,0,0};

const uint16_t dur[] = {10,1,14,10,1,28,10,1,28,10,1,14,10,1,28,10,1,113,10,1,43,10,1,43,10,1,43,10,1,28,10,1,28,10,1,14,10,1,28,10,1,19,10,1,19,10,1,19,10,1,28,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,43,10,1,43,10,1,43,10,1,43,10,1,28,10,1,28,10,1,14,10,1,28,10,1,19,10,1,19,10,1,19,10,1,28,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,71,10,1,14,10,1,14,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,28,10,1,14,10,1,14,10,1,43,10,1,14,10,1,14,10,1,14,10,1,28,10,1,28,10,1,28,10,1,14,10,1,86,10,1,14,10,1,14,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,28,10,1,14,10,1,14,10,1,43,10,1,43,10,1,43,10,1,143,10,1,14,10,1,14,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,28,10,1,14,10,1,14,10,1,43,10,1,14,10,1,14,10,1,14,10,1,28,10,1,28,10,1,28,10,1,14,10,1,86,10,1,14,10,1,14,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,28,10,1,14,10,1,14,10,1,43,10,1,43,10,1,43,10,1,113,10,1,14,10,1,28,10,1,28,10,1,14,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,129,10,1,14,10,1,28,10,1,28,10,1,14,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,28,10,1,14,10,1,28,10,1,113,10,1,43,10,1,43,10,1,43,10,1,28,10,1,28,10,1,14,10,1,28,10,1,19,10,1,19,10,1,19,10,1,28,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,43,10,1,43,10,1,43,10,1,43,10,1,28,10,1,28,10,1,14,10,1,28,10,1,19,10,1,19,10,1,19,10,1,28,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,43,10,1,14,10,1,28,10,1,43,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,19,10,1,19,10,1,19,10,1,19,10,1,19,10,1,19,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,43,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,14,10,1,19,10,1,19,10,1,19,10,1,113,10,1,14,10,1,28,10,1,43,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,19,10,1,19,10,1,19,10,1,19,10,1,19,10,1,19,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,43,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,14,10,1,19,10,1,19,10,1,19,10,1,113,10,1,14,10,1,28,10,1,28,10,1,14,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,28,10,1,14,10,1,14,10,1,129,10,1,14,10,1,28,10,1,28,10,1,14,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,28,10,1,14,10,1,28,10,1,113,10,1,14,10,1,28,10,1,43,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,19,10,1,19,10,1,19,10,1,19,10,1,19,10,1,19,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,43,10,1,28,10,1,14,10,1,28,10,1,14,10,1,56,10,1,14,10,1,28,10,1,14,10,1,19,10,1,19,10,1,19,10,1,1};
	
void SysTick_Init(void){
    NVIC_ST_CTRL_R = 0;
    NVIC_ST_CURRENT_R = 0;
    NVIC_ST_RELOAD_R = 600000;
    NVIC_SYS_PRI3_R = (NVIC_SYS_PRI3_R & 0x00FFFFFF) | 0x40000000; // priority 2
    NVIC_ST_CTRL_R = 0x06; // core clock and interrupts
}

void Song_Init(void){
    SysTick_Init();
		PortF_Init();
}

void Song_Play(void){
	note = 0;
    counter = dur[note];
    Sound_Play(pitch[note]);
    NVIC_ST_CTRL_R |= 0x01;
}

void Song_Stop(void){
    uint8_t i;
    NVIC_ST_CTRL_R &= ~0x01;
    Sound_Play(0);
}

extern "C" void SysTick_Handler(void);

void SysTick_Handler(void){
    if (--counter) {
        return;
    }
		if(++note == sizeof(dur)){
				Song_Stop();
				toggle_blue();
				return;
		}
		Sound_Play(pitch[note]);
    counter = dur[note];
		toggle_red();
}
